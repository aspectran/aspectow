<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="private.rooms">

	<resultMap id="privateRoomInfoMap" type="club.textchat.room.RoomInfo">
		<result property="roomId" column="room_id" />
		<result property="roomName" column="room_nm" />
		<result property="userNo" column="user_no" />
		<result property="cumulativeUsers" column="cumu_users" />
		<result property="currentUsers" column="curr_users" />
	</resultMap>

	<select id="getRoomInfo" parameterType="string" resultMap="privateRoomInfoMap">
		select
		    room_id, room_nm
		from private_rooms
		where room_id = #{roomId}
			and del_yn = 'N'
	</select>

    <insert id="insertRoom" parameterType="club.textchat.room.RoomInfo" useGeneratedKeys="true" keyProperty="roomId">
        insert into private_rooms (room_nm, user_no)
        values (#{roomName}, #{userNo})
    </insert>

	<update id="updateRoomForCheckIn" parameterType="string">
        update private_rooms set
        	cumu_users = cumu_users + 1,
        	curr_users = curr_users + 1,
        	used_dt = now()
        where room_id = #{roomId}
    </update>

	<update id="updateRoomForCheckOut" parameterType="string">
        update private_rooms set
        	curr_users = curr_users - 1,
        	used_dt = now()
        where room_id = #{roomId}
        	and curr_users &gt; 0
    </update>

</mapper>